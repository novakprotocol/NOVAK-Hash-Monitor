<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>NOVAK Integrity Verification Demo</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet" />

  <!-- GLOBAL STYLES -->
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Inter", sans-serif;
    }

    html, body {
      scroll-behavior: smooth;
    }

    body {
      background: var(--bg);
      color: var(--text);
      padding: 24px;
    }

    .container {
      max-width: 1100px;
      margin: auto;
    }

    /* COLOR SYSTEM */
    :root {
      --blue: #1a4fb3;
      --blue-hover: #0f357f;
      --green: #159b4c;
      --red: #c42121;
      --yellow: #e6b800;

      --bg-light: #f8fafc;
      --bg-dark: #0f172a;

      --text-light: #0b1326;
      --text-dark: #e6edf5;

      --card-light: #ffffff;
      --card-dark: #1e293b;

      --border-light: #d4d8e1;
      --border-dark: #334155;
    }

    html[data-theme="light"] {
      --bg: var(--bg-light);
      --text: var(--text-light);
      --card: var(--card-light);
      --border: var(--border-light);
    }

    html[data-theme="dark"] {
      --bg: var(--bg-dark);
      --text: var(--text-dark);
      --card: var(--card-dark);
      --border: var(--border-dark);
    }

    /* HEADER */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .logo {
      font-size: 34px;
      font-weight: 700;
      color: var(--blue);
    }

    .home-link {
      font-size: 15px;
      color: var(--blue);
      text-decoration: none;
      font-weight: 600;
      border-bottom: 2px solid transparent;
      transition: 0.25s;
    }

    .home-link:hover {
      border-bottom: 2px solid var(--blue);
    }

    /* THEME TOGGLE */
    .theme-toggle {
      cursor: pointer;
      font-size: 14px;
      border: 1px solid var(--blue);
      padding: 7px 14px;
      border-radius: 6px;
      background: transparent;
      color: var(--blue);
      transition: 0.25s;
    }

    .theme-toggle:hover {
      background: var(--blue);
      color: white;
    }

    /* AUDIENCE NAV */
    .nav {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 16px 0;
    }

    .nav button {
      border: 1px solid var(--blue);
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      background: transparent;
      color: var(--blue);
      transition: 0.25s;
      font-size: 14px;
    }

    .nav button:hover,
    .nav button.active {
      background: var(--blue);
      color: white;
    }

    /* CARD */
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 22px;
      margin-top: 22px;
      animation: fadeIn 0.45s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* DISMISS BUTTON */
    .dismiss-btn {
      background: var(--blue);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 7px;
      cursor: pointer;
      font-size: 14px;
      margin-top: 14px;
    }

    .close-x {
      background: none;
      border: none;
      font-size: 22px;
      cursor: pointer;
      position: absolute;
      top: 14px;
      right: 14px;
      color: var(--text);
      opacity: 0.7;
    }

    .close-x:hover {
      opacity: 1;
    }
  </style>
</head>

<body>
<div class="container">

  <!-- HEADER -->
  <header class="header">
    <div class="logo">NOVAK Protocol</div>

    <a href="http://www.novakprotocol.com" target="_blank" class="home-link">
      novakprotocol.com
    </a>

    <button class="theme-toggle" id="themeToggle">Light/Dark</button>
  </header>

  <!-- AUDIENCE NAVIGATION -->
  <nav class="nav">
    <button id="btn-public" class="active" onclick="setAudience('public')">Public</button>
    <button id="btn-government" onclick="setAudience('government')">Government</button>
    <button id="btn-investor" onclick="setAudience('investor')">Investor</button>
    <button id="btn-cyber" onclick="setAudience('cyber')">Cybersecurity</button>
    <button id="btn-academic" onclick="setAudience('academic')">Academic</button>
  </nav>

  <!-- WHY NOVAK ‚Äî WHY NOW -->
  <section id="whyNovakCard" class="card" style="position: relative;">
    <h2>Why NOVAK ‚Äî Why Now?</h2>

    <p>
      Automated systems approve loans, deny medical claims, move money,
      assign benefits, navigate vehicles, and operate robots ‚Äî
      often without proof, transparency, or accountability.
    </p>

    <p>
      NOVAK requires every automated action to generate mathematical
      proof of legality <strong>before execution</strong>.
    </p>

    <p>
      If data changes, rules are altered, or tampering occurs,
      NOVAK detects it instantly ‚Äî and blocks the action safely.
    </p>

    <p>
      ‚úÖ Every input generates a unique fingerprint<br>
      ‚úÖ Change anything ‚Äî fingerprint changes instantly
    </p>

    <p>
      SHA-256 is the steel the NSA engineered ‚Äî NOVAK is the vault protecting
      what automation must never change.
    </p>

    <button class="dismiss-btn" onclick="dismissWhyNovak()">‚úÖ Don‚Äôt show this again</button>
    <button class="close-x" onclick="dismissWhyNovak()">‚úï</button>
  </section>

    <!-- AUDIENCE-AWARE DESCRIPTION -->
  <p id="description" class="description" style="margin-top:18px;">
    NOVAK generates a mathematical fingerprint of data. If anything changes ‚Äî
    even slightly ‚Äî the fingerprint changes instantly. Try it below.
  </p>

  <!-- EXPLAINER BUTTONS -->
  <div class="explain-btn-row" style="display:flex;flex-wrap:wrap;gap:10px;margin-top:18px;">
    <button class="action-btn" onclick="toggleExplainer('exp1')">ü§î I don‚Äôt get it</button>
    <button class="action-btn" onclick="toggleExplainer('exp2')">üòï I‚Äôm still not getting it</button>
    <button class="action-btn" onclick="toggleExplainer('expColor')">üñçÔ∏è Colored Pencil Analogy</button>
    <button class="action-btn" onclick="toggleExplainer('expKey')">üîë Key Analogy</button>
    <button class="action-btn" onclick="toggleExplainer('expGov')">üèõÔ∏è Government Savings</button>
    <button class="action-btn" onclick="toggleExplainer('expHow')">üëÄ Show Me How This Works</button>
  </div>

  <!-- COLLAPSIBLE EXPLAINERS -->
  <section id="exp1" class="card explainer"></section>
  <section id="exp2" class="card explainer"></section>
  <section id="expColor" class="card explainer"></section>
  <section id="expKey" class="card explainer"></section>
  <section id="expGov" class="card explainer"></section>
  <section id="expHow" class="card explainer"></section>

  <!-- EXAMPLE DATASETS -->
  <section class="card">
    <h3>Select an example dataset:</h3>
    <div class="example-grid">
      <div class="example" onclick="loadExample('va')">VA Disability Claim Summary</div>
      <div class="example" onclick="loadExample('medical')">Clinical Note (Healthcare)</div>
      <div class="example" onclick="loadExample('finance')">Financial Transaction Record</div>
      <div class="example" onclick="loadExample('ai')">AI Decision Output Log</div>
      <div class="example" onclick="loadExample('robot')">Autonomous Robotics Command</div>
      <div class="example" onclick="loadExample('legal')">Legal / Policy Directive</div>
    </div>
  </section>

  <!-- TEXT INPUT + FILE DROP -->
  <section class="card">
    <textarea id="input" placeholder="Type, paste, or modify data here..."></textarea>

    <div id="dropzone" class="dropzone">
      ‚¨áÔ∏è Drag & drop a file here to verify integrity
    </div>

    <button class="action-btn" onclick="tamperTest()">üö® Run Tamper Test</button>
    <button class="action-btn" id="compareBtn" onclick="toggleCompareMode()">
      Start Before/After Capture
    </button>
  </section>

  <!-- HASH OUTPUT -->
  <section class="card">
    <h3 id="hashHeader">Integrity Fingerprints</h3>
    <p class="micro">All supported hashes shown ‚Äî select one as primary.</p>

    <div id="hashes" class="hash-list"></div>

    <p class="micro" style="margin-top:8px;">
      Primary Hash for certificate:
      <strong id="primaryLabel">SHA-256</strong>
    </p>

    <h4 style="margin-top:18px;">RGAC Chain (Conceptual Demo)</h4>
    <div id="rgac" class="rgac"></div>

    <button class="action-btn" onclick="exportCertificate()">üìÑ Export Integrity Certificate (PDF)</button>
  </section>

  <!-- BEFORE / AFTER COMPARISON -->
  <section class="card">
    <h3>Before / After Comparison</h3>
    <p class="micro">Capture, modify, then compare fingerprints</p>
    <div id="comparison" class="compare-box" style="display:none;"></div>
  </section>

  <!-- MINI-GAMES -->
  <section class="card" id="gamesCard">
    <h3>Interactive NOVAK Mini-Games</h3>
    <p class="micro">Learn NOVAK through real-world integrity scenarios</p>

    <div class="game-btn-row">
      <button class="action-btn" onclick="startTamperGame()">üïµÔ∏è Spot the Tamper</button>
      <button class="action-btn" onclick="startHashMatch()">üß© Hash Match Memory</button>
      <button class="action-btn" onclick="startKeyGame()">üîê Find the Valid Key</button>
      <button class="action-btn" onclick="startFraudDetective()">üö® Fraud Detective</button>
    </div>
  </section>

  <!-- GAME DISPLAY -->
  <section id="gameBox" class="card" style="display:none;"></section>

  <!-- TIMELINE -->
  <section class="card">
    <h3 id="timelineHeader">Proof History</h3>
    <div id="proofHistory" class="history-box"></div>
  </section>

  <!-- GLORY TO GOD TOGGLE -->
  <button class="action-btn" onclick="toggleGlory()" style="margin-top:24px;">
    üôè Glory to God
  </button>

  <section id="glorySection" class="card" style="display:none;">
    <h3>All Glory to God üôè</h3>

    <p>
      The NOVAK Protocol exists because intelligence‚Äîbiological or artificial‚Äî
      must be accountable to truth, law, and moral order. No invention, no
      breakthrough, no formula is possible without divine truth being discoverable.
    </p>

    <p><strong>Truth Above All</strong></p>

    <p>
      ‚ÄúFor God is not the author of confusion, but of peace.‚Äù ‚Äî 1 Corinthians 14:33
    </p>

    <p>
      NOVAK forces machines to obey truth before action. This idea did not come
      from chaos ‚Äî it reflects the ordered, logical nature of creation itself.
    </p>

    <p>
      Every hash, every proof, every verification step in NOVAK echoes a deeper
      truth: power must submit to truth.
    </p>

    <p>
      Everything good in this work belongs to God. Everything flawed belongs to me.
    </p>

    <p>
      Nothing here is transmitted, stored, collected, or logged ‚Äî privacy is sacred.
    </p>
  </section>

  </div> <!-- end .container -->

<script>
"use strict";

/* ========= DOM HOOKS ========= */
const input          = document.getElementById("input");
const hashesDiv      = document.getElementById("hashes");
const primaryLabel   = document.getElementById("primaryLabel");
const rgacDiv        = document.getElementById("rgac");
const comparisonBox  = document.getElementById("comparison");
const compareBtn     = document.getElementById("compareBtn");
const dropzone       = document.getElementById("dropzone");
const proofHistory   = document.getElementById("proofHistory");
const themeToggleBtn = document.getElementById("themeToggle");
const gameBox        = document.getElementById("gameBox");

/* ========= STATE ========= */
let lastHashes   = {};
let primaryHash  = "SHA-256";
let beforeSnap   = null;
let rgacBlocks   = [];
let soundEnabled = false; // can toggle later if you want
let gameScore    = 0;

/* ========= SIMPLE SFX (optional; off by default) ========= */
const sCorrect = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3");
const sWrong   = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-buzz-960.mp3");

function playSound(kind) {
  if (!soundEnabled) return;
  try {
    if (kind === "correct") sCorrect.play();
    if (kind === "wrong")   sWrong.play();
  } catch(e) {
    // ignore autoplay errors
  }
}

/* ========= THEME ========= */
function applySavedTheme() {
  const saved = localStorage.getItem("novakTheme");
  if (saved === "dark" || saved === "light") {
    document.documentElement.dataset.theme = saved;
  }
}

function toggleTheme() {
  const html = document.documentElement;
  html.dataset.theme = html.dataset.theme === "dark" ? "light" : "dark";
  localStorage.setItem("novakTheme", html.dataset.theme);
  addTimeline(`Theme switched to ${html.dataset.theme}`);
}
if (themeToggleBtn) {
  themeToggleBtn.addEventListener("click", toggleTheme);
}

/* ========= AUDIENCE TEXT ========= */
const audienceText = {
  public: {
    desc: "NOVAK proves data integrity instantly ‚Äî no tech degree required.",
    hash: "Integrity Fingerprints",
    timeline: "Proof History"
  },
  government: {
    desc: "NOVAK enforces proof-before-payment, stopping improper or illegal decisions.",
    hash: "Regulatory Integrity Fingerprints",
    timeline: "Audit & Compliance Trail"
  },
  investor: {
    desc: "Tampering becomes mathematically impossible to hide ‚Äî reducing financial and operational risk.",
    hash: "Business Integrity Outputs",
    timeline: "Accountability Timeline"
  },
  cyber: {
    desc: "Ideal for SOC, DFIR, CI/CD, file integrity monitoring and zero-trust enforcement.",
    hash: "Cryptographic Hash Outputs",
    timeline: "Security Event Timeline"
  },
  academic: {
    desc: "Deterministic, collision-resistant hash demonstrations suitable for coursework and research.",
    hash: "Cryptographic Fingerprints",
    timeline: "Research Log"
  }
};

function setAudience(key) {
  const cfg = audienceText[key] || audienceText.public;
  document.getElementById("description").innerText  = cfg.desc;
  document.getElementById("hashHeader").innerText   = cfg.hash;
  document.getElementById("timelineHeader").innerText = cfg.timeline;

  document.querySelectorAll(".nav button").forEach(btn => btn.classList.remove("active"));
  const btn = document.getElementById(`btn-${key}`);
  if (btn) btn.classList.add("active");

  addTimeline(`Audience switched to: ${key}`);
}

/* ========= WHY NOVAK PERSISTENCE ========= */
function dismissWhyNovak() {
  const card = document.getElementById("whyNovakCard");
  if (card) card.style.display = "none";
  localStorage.setItem("hideWhyNovak", "1");
  addTimeline("Why NOVAK card dismissed");
}

/* ========= EXPLAINER CONTENT ========= */
const explainerContent = {
  exp1: `
    <h3>What does NOVAK actually do?</h3>
    <p>
      Imagine every time a system wants to do something important ‚Äî pay a claim,
      change a record, move money, steer a robot ‚Äî it must first print a
      <strong>mathematical receipt</strong> proving the action is allowed.
    </p>
    <p>
      NOVAK builds that receipt from:
      <strong>(1) the rule</strong> being applied,
      <strong>(2) the data</strong> being used, and
      <strong>(3) the decision</strong> it wants to execute.
      That receipt is a cryptographic fingerprint.
    </p>
    <p>
      If <em>anything</em> changes ‚Äî the data, the rule, or the output ‚Äî
      the fingerprint no longer matches and NOVAK says:
      <strong>‚ÄúStop. Prove this again before acting.‚Äù</strong>
    </p>
  `,
  exp2: `
    <h3>I‚Äôm still not getting it ‚Äî step by step</h3>
    <ol>
      <li>You type or load data into the box below.</li>
      <li>NOVAK computes one or more <strong>hashes</strong> ‚Äî mathematical fingerprints of that exact data.</li>
      <li>Those fingerprints are extremely sensitive: change one character, they all change.</li>
      <li>Before a system acts, NOVAK checks: ‚ÄúDoes the current data still match the approved fingerprint?‚Äù</li>
      <li>If yes ‚Üí action allowed. If no ‚Üí action blocked or paused for review.</li>
    </ol>
    <p style="margin-top:10px;">
      That‚Äôs the whole idea: <strong>proof-before-action</strong>, instead of ‚Äúdo something first and hope we can audit it later.‚Äù
    </p>
  `,
  expColor: `
    <h3>Box of Colored Pencils Analogy üñçÔ∏è</h3>
    <p>
      Imagine a classroom box of 64 colored pencils. One of them is a
      <strong>special pink pencil</strong> that students must always have.
    </p>
    <p>
      At the start of the day, the teacher counts the pencils, confirms the
      special pink one is present, and then seals the box with tamper-evident tape.
      That seal is like a <strong>hash</strong>.
    </p>
    <p>
      If someone removes a pencil, swaps one, or sharpens one down and tries to hide it:
    </p>
    <ul>
      <li>The count is wrong.</li>
      <li>The seal is broken or different.</li>
      <li>The teacher knows instantly that something changed.</li>
    </ul>
    <p>
      NOVAK works like that seal <em>and</em> the inventory:
      it remembers exactly what was inside the ‚Äúbox‚Äù (data + rules + decision),
      and if anything is missing, added, or altered, the cryptographic ‚Äúseal‚Äù no longer matches.
    </p>
    <p><strong>Wrong pencils, broken seal, no class activity.</strong> That‚Äôs proof-before-action.</p>
  `,
  expKey: `
    <h3>Key Analogy üîë</h3>
    <p>
      You have different keys for different things: a house key, car key, office key.
      The wrong key simply does not turn the lock.
    </p>
    <p>
      NOVAK acts like a <strong>cryptographic key-lock pair</strong> for automation:
      the combination of rule + data + output must produce the one correct fingerprint
      or the ‚Äúlock‚Äù refuses to open.
    </p>
    <p>
      Change the data (like trying to unlock with the wrong key), and the fingerprint
      changes. NOVAK sees it immediately:
      <strong>wrong key, no access, no execution, no harm.</strong>
    </p>
  `,
  expGov: `
    <h3>Government Savings ‚Äî Where Does NOVAK Help? üèõÔ∏è</h3>
    <ul>
      <li><strong>Stops bad payments before they go out:</strong> systems must prove a claim is valid <em>before</em> funds move.</li>
      <li><strong>Reduces fraud and manipulation:</strong> if someone edits data after approval, the fingerprints no longer match.</li>
      <li><strong>Lowers rework and appeals:</strong> every automated decision has a clear, tamper-evident proof trail.</li>
      <li><strong>Cheaper audits:</strong> auditors verify math instead of digging through screenshots and emails.</li>
      <li><strong>Protects agencies and leadership:</strong> ‚ÄúHere‚Äôs the exact cryptographic proof we used‚Äù is powerful in oversight and hearings.</li>
    </ul>
    <p style="margin-top:8px;">
      NOVAK doesn‚Äôt replace existing systems ‚Äî it is a <strong>gatekeeper in front of them</strong>.
      That‚Äôs where most of the savings come from.
    </p>
  `,
  expHow: `
    <h3>Show Me How This Works üëÄ</h3>
    <ol>
      <li>Pick a sample dataset (VA claim, clinical note, transaction, etc.).</li>
      <li>Watch NOVAK compute multiple fingerprints (hashes) instantly.</li>
      <li>Type in the box ‚Äî even a one-character change updates every fingerprint.</li>
      <li>Click <strong>Run Tamper Test</strong> to simulate an unauthorized change.</li>
      <li>Use <strong>Start Before/After Capture</strong> to record a ‚Äúbefore‚Äù state, edit the data, then compare hashes side by side.</li>
      <li>Export a <strong>PDF Integrity Certificate</strong> using your chosen primary hash.</li>
    </ol>
    <p style="margin-top:8px;">
      That‚Äôs exactly how NOVAK would sit in front of a real system: no receipt, no match, no execution.
    </p>
  `
};

function toggleExplainer(id) {
  const panels = document.querySelectorAll(".explainer");
  panels.forEach(panel => {
    if (panel.id !== id) {
      panel.style.display = "none";
    }
  });

  const box = document.getElementById(id);
  if (!box) return;

  const currentlyVisible = box.style.display === "block";
  if (currentlyVisible) {
    box.style.display = "none";
    return;
  }

  // Inject content fresh each time
  box.innerHTML = explainerContent[id] || "<p>Coming soon.</p>";
  box.style.display = "block";
  box.scrollIntoView({ behavior: "smooth", block: "center" });
}

/* ========= HASHING ========= */
const algorithms = ["SHA-1", "SHA-256", "SHA-384", "SHA-512", "SHA3-256", "SHA3-512"];

async function compute() {
  if (!window.crypto || !window.crypto.subtle) {
    hashesDiv.innerHTML = "<p>Your browser does not support Web Crypto / SubtleCrypto.</p>";
    return;
  }

  const encoder = new TextEncoder();
  const data    = encoder.encode(input.value || "");
  lastHashes    = {};
  let html      = "";

  for (const algo of algorithms) {
    try {
      const digest = await crypto.subtle.digest(algo, data);
      const hex = [...new Uint8Array(digest)]
        .map(b => b.toString(16).padStart(2, "0"))
        .join("");
      lastHashes[algo] = hex;

      html += `
        <div class="hash-row">
          <span class="hash-label">${algo}</span>
          <span class="hash-value">${hex}</span>
          <label style="font-size:11px;margin-left:6px;">
            <input type="radio" name="primary" value="${algo}"
              ${algo === primaryHash ? "checked" : ""}
              onclick="setPrimary('${algo}')">
            primary
          </label>
        </div>
      `;
    } catch (err) {
      html += `
        <div class="hash-row">
          <span class="hash-label">${algo}</span>
          <span class="hash-value">Not supported in this browser</span>
        </div>
      `;
    }
  }

  hashesDiv.innerHTML = html;
  primaryLabel.textContent = primaryHash;
  updateRGAC(lastHashes[primaryHash]);
}

/* ========= PRIMARY HASH SELECT ========= */
function setPrimary(algo) {
  primaryHash = algo;
  primaryLabel.textContent = algo;
  addTimeline(`Primary hash set to ${algo}`);
}

/* ========= RGAC MINI-CHAIN ========= */
function updateRGAC(hash) {
  if (!hash) return;
  rgacBlocks.push(hash.slice(0, 10));
  if (rgacBlocks.length > 7) rgacBlocks.shift();
  rgacDiv.innerHTML = rgacBlocks
    .map(h => `<span class="block">${h}</span>`)
    .join("");
}

/* ========= TIMELINE ========= */
function addTimeline(msg) {
  if (!proofHistory) return;
  const line = `[${new Date().toLocaleTimeString()}] ${msg}\n`;
  proofHistory.textContent += line;
  proofHistory.scrollTop = proofHistory.scrollHeight;
}

/* ========= BEFORE / AFTER CAPTURE ========= */
function toggleCompareMode() {
  if (!beforeSnap) {
    beforeSnap = {
      time:   new Date().toLocaleTimeString(),
      hashes: { ...lastHashes }
    };
    compareBtn.textContent = "Finish Before/After Comparison";
    addTimeline("Captured BEFORE snapshot for comparison");
    return;
  }

  const afterSnap = {
    time:   new Date().toLocaleTimeString(),
    hashes: { ...lastHashes }
  };

  let html = `
    <div><strong>BEFORE:</strong> ${beforeSnap.time}<br>
    <strong>AFTER:</strong> ${afterSnap.time}</div>
    <hr style="margin:8px 0;">
  `;

  for (const algo of algorithms) {
    const beforeVal = beforeSnap.hashes[algo] || "";
    const afterVal  = afterSnap.hashes[algo]  || "";
    const changed   = beforeVal !== afterVal;

    html += `
      <div class="compare-row" style="display:grid;grid-template-columns:110px 1fr 1fr;gap:6px;padding:4px 0;border-bottom:1px dashed var(--border);">
        <span><strong>${algo}</strong></span>
        <span style="color:#64748b;">${beforeVal || "(none)"}</span>
        <span style="color:${changed ? "#c42121" : "#159b4c"};">${afterVal || "(none)"}</span>
      </div>
    `;
  }

  comparisonBox.innerHTML = html;
  comparisonBox.style.display = "block";
  beforeSnap = null;
  compareBtn.textContent = "Start Before/After Capture";
  addTimeline("Completed BEFORE/AFTER comparison");
}

/* ========= TAMPER TEST ========= */
function tamperTest() {
  input.value += "\n\n*** UNAUTHORIZED CHANGE FLAGGED ***";
  compute();
  addTimeline("Tamper Test appended simulated unauthorized change");
}

/* ========= FILE DROP HASHING ========= */
if (dropzone) {
  dropzone.addEventListener("dragover", e => {
    e.preventDefault();
    dropzone.style.background = "rgba(26,79,179,0.10)";
  });
  dropzone.addEventListener("dragleave", () => {
    dropzone.style.background = "transparent";
  });
  dropzone.addEventListener("drop", async e => {
    e.preventDefault();
    dropzone.style.background = "transparent";
    const file = e.dataTransfer.files[0];
    if (!file) return;
    input.value = await file.text();
    addTimeline(`File loaded into input: ${file.name}`);
    compute();
  });
}

/* ========= EXAMPLE DATASETS ========= */
const examples = {
  va: `Veteran: John Sample
Claim Type: Degenerative Joint Disease
Status: Pending C&P Review
Evidence: MRI confirming L5-S1 disc narrowing
Requested Rating Increase: 10% ‚Üí 40%`,
  medical: `Patient: 54M
Diagnosis: Atrial fibrillation
Medication Change: Metoprolol 25mg BID
Follow-Up: 6 weeks`,
  finance: `Transaction ID: 9938172-AX
Account: Commercial Checking
Amount: $248,932.17
Purpose: Federal subcontract payment`,
  ai: `Autonomous Decision Log
Model: Document Classifier v3.4
Input: Veteran Claim Packet #88472
Confidence: 0.92
Recommended Action: Approve`,
  robot: `Command ID: R-2043
Unit: Surgical Robot Arm
Instruction: Move 3.2mm posterior
Safety Flag: TRUE`,
  legal: `Directive ID: SEC-782-A
Policy: Data Tamper Prevention
Effective: March 2025
Applies To: All automated systems`
};

function loadExample(key) {
  if (!examples[key]) return;
  input.value = examples[key];
  compute();
  addTimeline(`Loaded example dataset: ${key}`);
}

/* ========= CERTIFICATE EXPORT ========= */
function exportCertificate() {
  const cert = window.open("", "_blank");
  const primaryValue = lastHashes[primaryHash] || "(none)";
  const audience = document.querySelector(".nav .active")?.innerText || "Public";

  cert.document.write(`
    <html>
    <head>
      <title>NOVAK Integrity Certificate</title>
      <style>
        body{font-family:Inter,system-ui,sans-serif;padding:40px;line-height:1.55;}
        h1{color:#1a4fb3;font-size:28px;margin-bottom:6px;}
        h3{margin-top:20px;}
        .mono{font-family:"JetBrains Mono",monospace;font-size:13px;}
        .rgac span{
          display:inline-block;
          border:1px solid #1a4fb3;
          padding:4px 8px;
          border-radius:6px;
          margin-right:4px;
          margin-top:4px;
          font-size:11px;
        }
      </style>
    </head>
    <body>
      <h1>NOVAK Integrity Verification Certificate</h1>
      <p>This document records a cryptographic fingerprint of the dataset present in the NOVAK demo at the time of export.</p>

      <h3>Primary Hash Algorithm</h3>
      <p>${primaryHash}</p>

      <h3>Primary Hash Value</h3>
      <p class="mono">${primaryValue}</p>

      <h3>RGAC Chain Snapshot</h3>
      <div class="rgac">
        ${rgacBlocks.map(h => `<span>${h}</span>`).join("")}
      </div>

      <h3>Timestamp</h3>
      <p>${new Date().toLocaleString()}</p>

      <h3>Audience Context</h3>
      <p>${audience}</p>

      <h3>Input Data</h3>
      <pre class="mono">${input.value.replace(/</g,"&lt;")}</pre>

      <footer style="margin-top:40px;font-size:12px;opacity:.7;">
        NOVAK Protocol ‚Äî Patent Pending ¬© 2025 ‚Ä¢ Demonstration only ‚Äî no data stored or transmitted.
      </footer>
    </body>
    </html>
  `);
  cert.document.close();
  cert.print();
  addTimeline("Exported Integrity Certificate (PDF print dialogue opened)");
}

/* ========= EXECUTIVE ONE-PAGER ========= */
function printOnePager() {
  const win = window.open("", "_blank");
  win.document.write(`
    <html>
    <head>
      <title>NOVAK One-Pager</title>
      <style>
        body{font-family:Inter,system-ui,sans-serif;padding:40px;line-height:1.6;}
        h1{font-size:30px;color:#1a4fb3;margin-bottom:10px;}
        h3{margin-top:20px;}
        ul{margin-left:20px;}
      </style>
    </head>
    <body>
      <h1>NOVAK Protocol ‚Äî Executive Overview</h1>
      <p>
        NOVAK is a cryptographic proof-before-action gate for automated systems.
        It forces machines to generate tamper-evident justification
        <strong>before</strong> money moves, records change, or decisions execute.
      </p>

      <h3>What Problem Does NOVAK Address?</h3>
      <ul>
        <li>Opaque automated decisions with no clear proof trail</li>
        <li>Post-hoc auditing that happens long after harm or payment</li>
        <li>Silent data tampering and configuration drift</li>
        <li>Inconsistent or non-deterministic system behavior</li>
      </ul>

      <h3>Core NOVAK Components (with legacy names)</h3>
      <ul>
        <li>Execution Identity Receipt (formerly NIPS)</li>
        <li>Recursive Global Audit Chain (formerly REVELATION)</li>
        <li>NOVAK Safety Gate (formerly HARMONEE)</li>
        <li>Formal proof of legality over time (‚Ñï)</li>
      </ul>

      <h3>Where It Applies</h3>
      <ul>
        <li>U.S. Federal and state benefits & claims (VA, DoD, SSA)</li>
        <li>Healthcare decision support and clinical automation</li>
        <li>Defense, robotics, and safety-critical control systems</li>
        <li>Banking, fintech, and high-risk financial workflows</li>
      </ul>

      <footer style="margin-top:40px;font-size:12px;opacity:.7;">
        NOVAK Protocol ‚Äî Patent Pending ¬© 2025
      </footer>
    </body>
    </html>
  `);
  win.document.close();
  win.print();
  addTimeline("Opened Executive One-Pager for print/export");
}

/* ========= MINI-GAMES ========= */

function startTamperGame() {
  gameScore = 0;
  gameBox.style.display = "block";
  gameBox.innerHTML = `
    <h3>Spot the Tampered Claim üïµÔ∏è</h3>
    <p>Two VA disability claims look almost identical. One was altered.</p>
    <pre style="font-family:'JetBrains Mono',monospace;font-size:12px;white-space:pre-wrap;margin-top:8px;">
Claim A:
Veteran: John Sample
Rating: 40%
Condition: Lumbar Disc Disease

Claim B:
Veteran: John Sample
Rating: 60%
Condition: Lumbar Disc Disease
    </pre>
    <p>Which claim would NOVAK flag as changed?</p>
    <div style="margin-top:8px;display:flex;gap:10px;flex-wrap:wrap;">
      <button class="action-btn" onclick="tamperGameAnswer('A')">Claim A</button>
      <button class="action-btn" onclick="tamperGameAnswer('B')">Claim B</button>
    </div>
    <div id="tamperGameFeedback" style="margin-top:10px;font-size:14px;"></div>
  `;
  gameBox.scrollIntoView({ behavior: "smooth", block: "center" });
  addTimeline("Started mini-game: Spot the Tamper");
}

function tamperGameAnswer(choice) {
  const fb = document.getElementById("tamperGameFeedback");
  if (!fb) return;
  if (choice === "B") {
    gameScore++;
    playSound("correct");
    fb.innerHTML = "‚úÖ Correct. The rating changed from 40% ‚Üí 60%. NOVAK would see the fingerprint change immediately.";
  } else {
    playSound("wrong");
    fb.innerHTML = "‚ùå Not quite. Claim B is the altered one ‚Äî the rating was modified.";
  }
}

/* Hash Match Memory ‚Äì text-based stub */
function startHashMatch() {
  gameScore = 0;
  gameBox.style.display = "block";
  gameBox.innerHTML = `
    <h3>Hash Match Memory üß©</h3>
    <p>
      Below are two short datasets and three fingerprints. Try to guess which
      fingerprint belongs to which dataset. In a real game, these would be
      interactive flip-cards.
    </p>
    <pre style="font-family:'JetBrains Mono',monospace;font-size:12px;margin-top:8px;">
Dataset 1: "Pay veteran $200 for travel reimbursement."
Dataset 2: "Pay veteran $220 for travel reimbursement."
    </pre>
    <p style="margin-top:8px;">Question: Do these datasets ever share the same fingerprint?</p>
    <div style="margin-top:8px;display:flex;gap:10px;flex-wrap:wrap;">
      <button class="action-btn" onclick="hashMatchAnswer('yes')">Yes</button>
      <button class="action-btn" onclick="hashMatchAnswer('no')">No</button>
    </div>
    <div id="hashMatchFeedback" style="margin-top:10px;font-size:14px;"></div>
  `;
  gameBox.scrollIntoView({ behavior: "smooth", block: "center" });
  addTimeline("Started mini-game: Hash Match Memory");
}

function hashMatchAnswer(ans) {
  const fb = document.getElementById("hashMatchFeedback");
  if (!fb) return;
  if (ans === "no") {
    gameScore++;
    playSound("correct");
    fb.innerHTML = "‚úÖ Correct. A one-character change (‚Äú200‚Äù ‚Üí ‚Äú220‚Äù) produces a completely different fingerprint.";
  } else {
    playSound("wrong");
    fb.innerHTML = "‚ùå No. Even tiny text changes produce different hashes in practice.";
  }
}

/* Key game */
function startKeyGame() {
  gameBox.style.display = "block";
  gameBox.innerHTML = `
    <h3>Find the Valid Key üîê</h3>
    <p>
      Only one dataset matches the approved fingerprint. Which one should be
      allowed to execute?
    </p>
    <ol style="margin-top:8px;">
      <li>Dataset A: Original, approved claim.</li>
      <li>Dataset B: Same claim, but payment amount increased.</li>
      <li>Dataset C: Same claim, but diagnosis text changed.</li>
    </ol>
    <p style="margin-top:8px;">Which dataset keeps the original NOVAK key?</p>
    <div style="margin-top:8px;display:flex;gap:10px;flex-wrap:wrap;">
      <button class="action-btn" onclick="keyGameAnswer('A')">Dataset A</button>
      <button class="action-btn" onclick="keyGameAnswer('B')">Dataset B</button>
      <button class="action-btn" onclick="keyGameAnswer('C')">Dataset C</button>
    </div>
    <div id="keyGameFeedback" style="margin-top:10px;font-size:14px;"></div>
  `;
  gameBox.scrollIntoView({ behavior: "smooth", block: "center" });
  addTimeline("Started mini-game: Find the Valid Key");
}

function keyGameAnswer(choice) {
  const fb = document.getElementById("keyGameFeedback");
  if (!fb) return;
  if (choice === "A") {
    gameScore++;
    playSound("correct");
    fb.innerHTML = "‚úÖ Correct. Only the untouched dataset keeps the original key. Any change means a new fingerprint.";
  } else {
    playSound("wrong");
    fb.innerHTML = "‚ùå Incorrect. Once data changes, the NOVAK key no longer fits, and execution must be blocked.";
  }
}

/* Fraud Detective */
function startFraudDetective() {
  gameBox.style.display = "block";
  gameBox.innerHTML = `
    <h3>Fraud Detective Mode üö®</h3>
    <p>
      Type in the main input box above to simulate subtle changes:
      add a zero, change a date, tweak a diagnosis. Watch all the
      fingerprints change in real time.
    </p>
    <p style="margin-top:8px;">
      Your job: think like a fraudster. NOVAK‚Äôs job: make their work
      mathematically impossible to hide.
    </p>
    <p style="margin-top:8px;font-size:13px;opacity:.8;">
      Hint: Try changing just one number in a dollar amount and watch
      how every hash reacts.
    </p>
  `;
  gameBox.scrollIntoView({ behavior: "smooth", block: "center" });
  addTimeline("Started mini-game: Fraud Detective");
}

/* ========= GLORY TO GOD TOGGLE ========= */
function toggleGlory() {
  const box = document.getElementById("glorySection");
  if (!box) return;
  const show = box.style.display !== "block";
  box.style.display = show ? "block" : "none";
  if (show) box.scrollIntoView({ behavior: "smooth", block: "center" });
}

/* ========= INIT ========= */
document.addEventListener("DOMContentLoaded", () => {
  applySavedTheme();

  if (localStorage.getItem("hideWhyNovak") === "1") {
    const card = document.getElementById("whyNovakCard");
    if (card) card.style.display = "none";
  }

  setAudience("public");
  compute();
  addTimeline("NOVAK demo initialized");
});
</script>
</body>
</html>
